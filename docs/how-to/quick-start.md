# Quick Start Guide

A quick start guide to building your own app with ORMJS.

## By Example

The folder `docs/app` contains an example web app that uses ORMJS. The landing page, `index.html`, is located in the top level of the project directory in order to host the example app on Github. See it [here](https://crhunt.github.io/ormjs/).

The page `preloaded.html` shows an example of how to load an SVG generated by ORMJS into a webpage and make it interactive / editable with ORMJS.

## What you'll need

The following components are necessary to include in your application.

Javascript:

- d3 library: `lib/eternal/d3.v7.js`
- d3 context menu: `lib/external/d3-context-menu.js`
- ORMJS: `lib/ormjs.min.js`

Stylesheets:

- d3 context menu: `style/external/d3-context-menu.css`
- ORMJS: `style/ormjs.style.min.css`

Your header will look something like,

```
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <!-- ORMJS Style -->
    <link rel="stylesheet" href="style/external/d3-context-menu.css" type="text/css" />
    <link rel="stylesheet" href="style/ormjs.style.min.css" type="text/css" />
    
    <!-- ORMJS 3rd party libraries -->
    <script type="text/javascript" src="lib/external/d3.v7.js" charset="UTF-8"></script>
    <script type="text/javascript" src="lib/external/d3-context-menu.js" charset="UTF-8"></script>

    <!-- ORMJS library>
    <script type="text/javascript" src="lib/ormjs.min.js" charset="UTF-8"></script>

    ...
</head>
```

Be sure the paths align with your project structure. Also be sure to include the ORMJS style after d3-context-menu in order to use style overrides in ORMJS.

> Note: The d3 library does not need to be included directly in your project. You can link to it like so: 
>
> `<script type="text/javascript" src="https://d3js.org/d3.v7.min.js"></script>
`

## Build a diagram

### Initialize ORMJS

Initialize ORMJS at the start of a session or on page load.

```
var ormjs;
ormjs.initialize();
```

### Create a model

```
// Create model
var model = new ormjs.Model();
```

Optional settings:

| Setting | Type | Action |
| --- | --- | --- |
| model.generate_xml | boolean | Generate XML on each change to the model |
| model.xml_target | string | Id of the DOM element innerHTML to receive the generated XML code. |
| model.generate_rel  | boolean | Generate Rel on each change to the model |
| model.rel_target | string | Id of the DOM element innerHTML to receive the generated Rel code. |

### Create a view for the model

Each view must belong to a model. Specify the model by its id.

A view must be contained in a parent DOM element, such as a `div`. Here, the parent has the id "canvas". The size of the view is inherited from the size of the parent element.

```
// Create SVG
var view = new ormjs.View({model: model.id, parent: "canvas"});
```

Only the diagram objects that are generated within a view will be visible in that view. However, the overarching ORM logic will apply across views. Therefore, for example, you may see shadows on objects that only appear once in a view, but appear more than once in the model.

Optional settings:

| Setting | Type | Action |
| --- | --- | --- |
| view.highlight | boolean | Highlight diagram elements not translated to Rel code. |
| view.traversal | boolean | Enable traversal viewing mode. |
| view.traversal_target | string | Id of DOM element innerHTML to receive the traversal data. |

Views may also be generated from SVG data exported from ORMJS. To create a view from a DOM element containing SVG data, 

```
var view = ormjs.View.from_parent("canvas");
```

### Draw an entity

Each object must be assigned a view by id and a location in the view. The center of each view is (0,0).

```
// Draw an entity
var entity = new ormjs.Entity({x: 0, y: 0, view: view.id})
```

### Draw a value

```
// Draw an value
var value = new ormjs.Value({x: 0, y: 0, view: view.id})
```

### Draw a predicate

```
// Draw a predicate
var pred = new ormjs.Predicate({x: 0, y: 0, view: view.id})
```

#### Flip a predicate

```
pred.flip()
```

#### Rotate a predicate

```
pred.rotate()
```

#### Add a rolebox to a predicate

```
var rbox = pred.add_rolebox()
```

### Set internal uniqueness constraint (IUC) on rolebox

```
rbox.d3object.datum().multiplicity = "none"; // or: "one", "many", "skip"
rbox.set_internal_uc()
```

Note that it is possible to set combinations of IUCs on a predicate that are disallowed in ORM.

#### Toggle mandatory constraint on rolebox true/false

```
rbox.flip_mandatory()
```

### Create an external constraint

```
var const = new ormjs.Constraint({x: 0, y: 0, view: view.id})
```

#### Change type of external constraint

```
const.d3object.datum().type = "equality";
const.redraw();
```

Supported constraints: "inclusive-or", "exclusion", "exclusive-or", "equality","identifier", "preferred-identifier", "subset", "external-frequency", "internal-frequency"

For constraint with content:

```
const.d3object.datum().type = "external-frequency";
const.set_content(">= 2");
const.redraw();
```

### Connect objects

Any two objects can be connected via their ID's. The connection type will default to what is allowed between the two objects. Note that the order of objects is important for subtype relationships.

```
var conn = ormjs.Connector.connect_by_id(entity.id, pred.id)
```
